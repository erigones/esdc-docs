<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" version="1.1" viewBox="-1 0 813 986" width="813pt" height="986pt" xmlns:dc="http://purl.org/dc/elements/1.1/"><metadata> Erigones <dc:date>2016-12-27 19:41Z</dc:date></metadata><defs><marker orient="auto" overflow="visible" markerUnits="strokeWidth" id="StickArrow_Marker" viewBox="-1 -6 14 12" markerWidth="14" markerHeight="12" color="black"><g><path d="M 11.428568 0 L 0 0 M 0 -4.285713 L 11.428568 0 L 0 4.285713" fill="none" stroke="currentColor" stroke-width="1"/></g></marker><font-face font-family="Helvetica" font-size="15" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="532.22656" cap-height="719.72656" ascent="770.01953" descent="-229.98047" font-weight="bold"><font-face-src><font-face-name name="Helvetica-Bold"/></font-face-src></font-face><font-face font-family="Helvetica" font-size="12" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="522.94922" cap-height="717.28516" ascent="770.01953" descent="-229.98047" font-weight="500"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><font-face font-family="Helvetica" font-size="14" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="532.22656" cap-height="719.72656" ascent="770.01953" descent="-229.98047" font-weight="bold"><font-face-src><font-face-name name="Helvetica-Bold"/></font-face-src></font-face><font-face font-family="Helvetica" font-size="13" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="532.22656" cap-height="719.72656" ascent="770.01953" descent="-229.98047" font-weight="bold"><font-face-src><font-face-name name="Helvetica-Bold"/></font-face-src></font-face><font-face font-family="Helvetica" font-size="12" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="532.22656" cap-height="719.72656" ascent="770.01953" descent="-229.98047" font-weight="bold"><font-face-src><font-face-name name="Helvetica-Bold"/></font-face-src></font-face></defs><g stroke="none" stroke-opacity="1" stroke-dasharray="none" fill="none" fill-opacity="1"><title>Canvas 1</title><rect fill="white" width="806" height="1132"/><g><title>Layer 1</title><ellipse cx="34.015748" cy="20.615605" rx="11.338601" ry="10.307819" fill="white"/><ellipse cx="34.015748" cy="20.615605" rx="11.338601" ry="10.307819" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="34.015748" y1="30.923407" x2="34.015748" y2="61.846814" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="34.015748" y1="61.846814" x2="22.677165" y2="92.77022" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="34.015748" y1="61.846814" x2="45.35433" y2="92.77022" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="34.015748" y1="41.23121" x2="11.3385826" y2="41.23121" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="56.692913" y1="41.23121" x2="34.015748" y2="41.23121" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><line x1="68.031496" y1="48.188976" x2="411.86828" y2="47.96157" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(70.091698 28.163442)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="12.5097656">1.</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="maroon" x="12.5097656" y="15" textLength="189.73828"> vm_create_snapshot() -&gt; SOCKET</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="maroon" x="200.91797" y="15" textLength="146.32617">.emit(‘PUT’, ‘vm_snapshot&apos;)</tspan></text><path d="M 544.25197 133.228346 L 544.25197 277.79527 L 98.367825 275.96036" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(143.99815 257.062)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="25.019531">3a. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="25.019531" y="15" textLength="374.03906">que.tasks.execute() -&gt; @task(‘execute’, ‘zfs snapshot’) on fast.node02</tspan></text><path d="M 425.19685 123.89501 L 399.68504 99 L 96.37795 99 L 79.061395 87.25229" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(124.44556 79.09091)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="25.839844">3b. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="black" x="25.839844" y="15" textLength="140.71875">emit(‘message’, response)</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="maroon" x="166.55859" y="15" textLength="94.376953"> -&gt; on_message()</tspan></text><line x1="85.03937" y1="410.07874" x2="559.26986" y2="410.3085" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(158.57206 390.25033)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">4. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="168.91406">@task(‘execute’, ‘zfs snapshot’)</tspan></text><path d="M 558.4252 476.22047 L 558.4252 325.70079 L 580.87926 308.97638 L 782.96587 308.97638 L 782.96587 459.49606 L 760.5118 476.22047 L 558.4252 476.22047 M 558.4252 325.70079 L 760.5118 325.70079 L 782.96587 308.97638 M 760.5118 325.70079 L 760.5118 476.22047" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(563.4252 325.70079)" fill="black"><tspan font-family="Helvetica" font-size="14" font-weight="bold" x="0" y="14" textLength="97.993164">Compute node</tspan></text><path d="M 577.59842 365.6693 L 729.17322 365.6693 C 731.93465 365.6693 734.17322 367.90787 734.17322 370.6693 L 734.17322 420.19685 C 734.17322 422.95827 731.93465 425.19685 729.17322 425.19685 L 577.59842 425.19685 C 574.837 425.19685 572.59842 422.95827 572.59842 420.19685 L 572.59842 370.6693 C 572.59842 367.90787 574.837 365.6693 577.59842 365.6693 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(577.59842 365.6693)" fill="black"><tspan font-family="Helvetica" font-size="13" font-weight="bold" x="0" y="13" textLength="62.12451">erigonesd</tspan></text><rect x="583.937" y="388.34645" width="138.89764" height="19.842522" fill="white"/><rect x="583.937" y="388.34645" width="138.89764" height="19.842522" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(586.937 391.34645)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="11" textLength="108.714844">fast.node02 (CPU x)</tspan></text><rect x="702.99212" y="388.34645" width="19.84252" height="19.84252" id="path"/><clipPath id="clip_path"><use xl:href="#path"/></clipPath><g clip-path="url(#clip_path)"><image xl:href="image5.png" width="128" height="128" transform="translate(702.99212 388.34645) scale(.15501969)"/></g><rect x="579.6271" y="431.93398" width="182.13678" height="44.286418" id="path_2"/><clipPath id="clip_path_2"><use xl:href="#path_2"/></clipPath><g clip-path="url(#clip_path_2)"><image xl:href="image4.png" width="900" height="200" transform="matrix(.2023742 0 0 .22143209 579.6271 431.93398)"/></g><rect x="558.4252" y="496.22047" width="246.61417" height="74" fill="white"/><rect x="558.4252" y="496.22047" width="246.61417" height="74" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(563.4252 496.22047)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">5. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="172.08984">subprocess.Popen() -&gt; result = {</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="29" textLength="70.02539">     ‘stdout’: ‘’,</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="43" textLength="50.009766">     ‘stderr</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="50.455078" y="43" textLength="18">’: ‘’,</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="57" textLength="91.371094">     ‘returncode’: ‘’</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="71" textLength="65.033203">} -&gt; callback</tspan></text><rect x="558.4252" y="476.22047" width="246.61417" height="20" fill="white"/><rect x="558.4252" y="476.22047" width="246.61417" height="20" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(563.4252 479.22047)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="58.27779" y="11" textLength="120.058594">Que.tasks._execute()</tspan></text><rect x="783.72703" y="476.22047" width="21.312336" height="19.217559" id="path_3"/><clipPath id="clip_path_3"><use xl:href="#path_3"/></clipPath><g clip-path="url(#clip_path_3)"><image xl:href="image5.png" width="128" height="128" transform="matrix(.16650263 0 0 .15013718 783.72703 476.22047)"/></g><line x1="558.4252" y1="538.88714" x2="98.36708" y2="544.10092" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(155.31597 521.47182)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">6. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="348.6504">send_task_forever() -&gt; @task(‘vm_snapshot_cb’, result) on mgmt</tspan></text><path d="M 430.19685 648.50393 L 581.77165 648.50393 C 584.53307 648.50393 586.77165 650.7425 586.77165 653.50393 L 586.77165 700.19685 C 586.77165 702.95827 584.53307 705.19685 581.77165 705.19685 L 430.19685 705.19685 C 427.43542 705.19685 425.19685 702.95827 425.19685 700.19685 L 425.19685 653.50393 C 425.19685 650.7425 427.43542 648.50393 430.19685 648.50393 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 648.50393)" fill="black"><tspan font-family="Helvetica" font-size="13" font-weight="bold" x="0" y="13" textLength="113.80078">erigonesd @mgmt</tspan></text><rect x="436.53543" y="671.1811" width="138.89764" height="19.842522" fill="white"/><rect x="436.53543" y="671.1811" width="138.89764" height="19.842522" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(439.53543 674.1811)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="11" textLength="66.01758">mgmt (512*)</tspan></text><rect x="555.59055" y="671.1811" width="19.84252" height="19.84252" id="path_4"/><clipPath id="clip_path_4"><use xl:href="#path_4"/></clipPath><g clip-path="url(#clip_path_4)"><image xl:href="image5.png" width="128" height="128" transform="translate(555.59055 671.1811) scale(.15501969)"/></g><rect x="425.19685" y="725.19685" width="164.40945" height="60" fill="white"/><rect x="425.19685" y="725.19685" width="164.40945" height="60" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 725.19685)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="12.5097656">8.</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="29" textLength="112.04883">- Vm/Snapshot in DB</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="43" textLength="42.017578">- unlock</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="57" textLength="121.365234">- task_log (SUCCESS)</tspan></text><rect x="425.19685" y="705.19685" width="164.40945" height="20" fill="white"/><rect x="425.19685" y="705.19685" width="164.40945" height="20" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 708.19685)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="28.188122" y="11" textLength="98.033203">vm_snapshot_cb</tspan></text><rect x="568.29396" y="705.19685" width="21.312336" height="19.217559" id="path_5"/><clipPath id="clip_path_5"><use xl:href="#path_5"/></clipPath><g clip-path="url(#clip_path_5)"><image xl:href="image5.png" width="128" height="128" transform="matrix(.16650263 0 0 .15013718 568.29396 705.19685)"/></g><line x1="85.03937" y1="678.4252" x2="411.86842" y2="676.9121" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(156.92732 657.74104)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">7. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="174.24609">@task(‘vm_snapshot_cb’, result)</tspan></text><rect x="425.19685" y="77.228346" width="238.11023" height="56" fill="white"/><rect x="425.19685" y="77.228346" width="238.11023" height="56" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 77.228346)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="11" textLength="138.41016">response = call_api_view(</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="25" textLength="63.36328">      request,</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="39" textLength="215.43164">      api.vm.snapshot.views.vm_snapshot</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="53" textLength="3.9960938">)</tspan></text><rect x="425.19685" y="45.874015" width="238.11023" height="32" fill="white"/><rect x="425.19685" y="45.874015" width="238.11023" height="32" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 45.874015)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">2. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="130.7168">APINamespace.on_vm()</tspan></text><rect x="425.19685" y="17.874015" width="238.11023" height="28" fill="white"/><rect x="425.19685" y="17.874015" width="238.11023" height="28" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 17.874015)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="77.724063" y="11" textLength="72.66211">gunicorn-sio</tspan><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="69.362735" y="25" textLength="89.384766">namespaces.py</tspan></text><rect x="640.6299" y="19.842519" width="22.677166" height="22.677166" id="path_6"/><clipPath id="clip_path_6"><use xl:href="#path_6"/></clipPath><g clip-path="url(#clip_path_6)"><image xl:href="image1.png" width="200" height="200" transform="translate(640.6299 19.842519) scale(.11338583)"/></g><rect x="663.3071" y="82.72441" width="138.89764" height="42" fill="white"/><rect x="663.3071" y="82.72441" width="138.89764" height="42" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(668.3071 82.72441)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="11" textLength="112.04883">- Vm/Snapshot in DB</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="25" textLength="28.669922">- lock</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="39" textLength="118.02539">- task_log (PENDING)</tspan></text><rect x="425.19685" y="907.95275" width="238.11023" height="70" fill="white"/><rect x="425.19685" y="907.95275" width="238.11023" height="70" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 907.95275)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="11" textLength="141.375">For every task that starts/fi</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="141.375" y="11" textLength="38.021484">nishes:</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="25" textLength="156.05859">    - check if task has callback</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="39" textLength="179.0918">    - if it has callback -&gt; do nothing</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="53" textLength="211.07227">    - if it is the last task in chain -&gt; inform</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="0" y="67" textLength="174.04688">           -&gt; get task result -&gt; emit()</tspan></text><rect x="425.19685" y="876.5984" width="238.11023" height="32" fill="white"/><rect x="425.19685" y="876.5984" width="238.11023" height="32" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 876.5984)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="16.677246">9. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="16.677246" y="15" textLength="160.72266">Celery real-time event monitor</tspan></text><rect x="425.19685" y="848.5984" width="238.11023" height="28" fill="white"/><rect x="425.19685" y="848.5984" width="238.11023" height="28" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(430.19685 848.5984)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="77.724063" y="11" textLength="72.66211">gunicorn-sio</tspan><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="29.855899" y="25" textLength="44.660156">monitor</tspan><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="73.859805" y="25" textLength="124.39453">.py -&gt; namespaces.py</tspan></text><rect x="640.6299" y="850.5669" width="22.677166" height="22.677166" id="path_7"/><clipPath id="clip_path_7"><use xl:href="#path_7"/></clipPath><g clip-path="url(#clip_path_7)"><image xl:href="image1.png" width="200" height="200" transform="translate(640.6299 850.5669) scale(.11338583)"/></g><line x1="85.03937" y1="812.5984" x2="412.00385" y2="859.59115" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><path d="M 425.19685 919.6194 L 138.89764 919.6194 L 138.55941 825.78766 C 144.05937 825.76784 144.01972 814.7679 138.51976 814.78774 L 138.04716 683.67984 C 143.54713 683.66 143.50748 672.6601 138.00751 672.6799 L 137.56226 549.15692 C 143.06222 549.1371 143.02257 538.13716 137.52261 538.157 L 137.08085 415.6039 C 142.58081 415.58408 142.54116 404.58415 137.0412 404.60398 L 136.59788 281.61757 C 142.09784 281.59774 142.05819 270.59781 136.55823 270.61764 L 136.06299 133.228346 L 80.794197 116.58878" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(144.53095 899.71033)" fill="black"><tspan font-family="Helvetica" font-size="15" font-weight="bold" fill="black" x="0" y="15" textLength="25.019531">10. </tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" x="25.019531" y="15" textLength="132.703125">emit(‘task_status’, result)</tspan><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="maroon" x="157.72266" y="15" textLength="106.38281"> -&gt; on_task_status()</tspan></text><path d="M 13.503937 141.73228 L 80.03937 141.73228 C 82.800793 141.73228 85.03937 143.97086 85.03937 146.73228 L 85.03937 941.77165 C 85.03937 944.53307 82.800793 946.77165 80.03937 946.77165 L 13.503937 946.77165 C 10.742513 946.77165 8.503937 944.53307 8.503937 941.77165 L 8.503937 146.73228 C 8.503937 143.97086 10.742513 141.73228 13.503937 141.73228 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(13.503937 141.73228)" fill="black"><tspan font-family="Helvetica" font-size="13" font-weight="bold" x="0" y="13" textLength="61.381836">RabbitMQ</tspan><tspan font-family="Helvetica" font-size="13" font-weight="bold" x="0" y="29" textLength="41.907227">(:5672)</tspan></text><rect x="19.84252" y="172.91338" width="28.346457" height="28.346457" id="path_8"/><clipPath id="clip_path_8"><use xl:href="#path_8"/></clipPath><g clip-path="url(#clip_path_8)"><image xl:href="image6.png" width="600" height="600" transform="translate(19.84252 172.91338) scale(.047244094)"/></g></g></g></svg>
